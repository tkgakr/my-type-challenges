#!/bin/bash

echo "ğŸ“Š é€²æ—ã‚’é›†è¨ˆä¸­..."

# ã‚«ã‚¦ãƒ³ãƒˆå¤‰æ•°
EASY_TOTAL=0
EASY_SOLVED=0
MEDIUM_TOTAL=0
MEDIUM_SOLVED=0
HARD_TOTAL=0
HARD_SOLVED=0
EXTREME_TOTAL=0
EXTREME_SOLVED=0

# å„é›£æ˜“åº¦ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚«ã‚¦ãƒ³ãƒˆ
for dir in solutions/easy/*; do
  [ -d "$dir" ] && ((EASY_TOTAL++))
  if [ -f "$dir/solution.ts" ]; then
    # TODOãŒæ®‹ã£ã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
    ! grep -q "TODO" "$dir/solution.ts" && ((EASY_SOLVED++))
  fi
done

for dir in solutions/medium/*; do
  [ -d "$dir" ] && ((MEDIUM_TOTAL++))
  if [ -f "$dir/solution.ts" ]; then
    ! grep -q "TODO" "$dir/solution.ts" && ((MEDIUM_SOLVED++))
  fi
done

for dir in solutions/hard/*; do
  [ -d "$dir" ] && ((HARD_TOTAL++))
  if [ -f "$dir/solution.ts" ]; then
    ! grep -q "TODO" "$dir/solution.ts" && ((HARD_SOLVED++))
  fi
done

for dir in solutions/extreme/*; do
  [ -d "$dir" ] && ((EXTREME_TOTAL++))
  if [ -f "$dir/solution.ts" ]; then
    ! grep -q "TODO" "$dir/solution.ts" && ((EXTREME_SOLVED++))
  fi
done

TOTAL_ATTEMPTS=$((EASY_TOTAL + MEDIUM_TOTAL + HARD_TOTAL + EXTREME_TOTAL))
TOTAL_SOLVED=$((EASY_SOLVED + MEDIUM_SOLVED + HARD_SOLVED + EXTREME_SOLVED))

# progress.mdã‚’ç”Ÿæˆ
cat > progress.md << EOF
# ğŸ“ˆ Type Challenges Progress

æœ€çµ‚æ›´æ–°: $(date '+%Y-%m-%d %H:%M:%S')

## ğŸ“Š çµ±è¨ˆã‚µãƒãƒªãƒ¼
- **ç·ãƒãƒ£ãƒ¬ãƒ³ã‚¸æ•°**: ${TOTAL_ATTEMPTS}
- **å®Œäº†æ•°**: ${TOTAL_SOLVED}
- **å®Œäº†ç‡**: $([ $TOTAL_ATTEMPTS -gt 0 ] && echo "scale=1; $TOTAL_SOLVED * 100 / $TOTAL_ATTEMPTS" | bc || echo 0)%

## ğŸ† é›£æ˜“åº¦åˆ¥é€²æ—

### ğŸŸ¢ Easy
- è©¦è¡Œ: ${EASY_TOTAL}
- å®Œäº†: ${EASY_SOLVED}
- é€²æ—: $([ $EASY_TOTAL -gt 0 ] && echo "scale=1; $EASY_SOLVED * 100 / $EASY_TOTAL" | bc || echo 0)%

### ğŸŸ¡ Medium  
- è©¦è¡Œ: ${MEDIUM_TOTAL}
- å®Œäº†: ${MEDIUM_SOLVED}
- é€²æ—: $([ $MEDIUM_TOTAL -gt 0 ] && echo "scale=1; $MEDIUM_SOLVED * 100 / $MEDIUM_TOTAL" | bc || echo 0)%

### ğŸ”´ Hard
- è©¦è¡Œ: ${HARD_TOTAL}
- å®Œäº†: ${HARD_SOLVED}
- é€²æ—: $([ $HARD_TOTAL -gt 0 ] && echo "scale=1; $HARD_SOLVED * 100 / $HARD_TOTAL" | bc || echo 0)%

### ğŸŸ£ Extreme
- è©¦è¡Œ: ${EXTREME_TOTAL}
- å®Œäº†: ${EXTREME_SOLVED}
- é€²æ—: $([ $EXTREME_TOTAL -gt 0 ] && echo "scale=1; $EXTREME_SOLVED * 100 / $EXTREME_TOTAL" | bc || echo 0)%

## ğŸ“… æ´»å‹•å±¥æ­´
$(ls -1 logs/daily/*.md 2>/dev/null | tail -5 | while read f; do echo "- [$(basename $f .md)](${f})"; done)

---
*Generated by progress.sh*
EOF

# README.mdã‚’æ›´æ–°
cat > README.md << EOF
# ğŸš€ My Type Challenges Journey

![](https://img.shields.io/badge/Solved-${TOTAL_SOLVED}-green)
![](https://img.shields.io/badge/Attempted-${TOTAL_ATTEMPTS}-blue)
![](https://img.shields.io/badge/Success_Rate-$([ $TOTAL_ATTEMPTS -gt 0 ] && echo "scale=0; $TOTAL_SOLVED * 100 / $TOTAL_ATTEMPTS" | bc || echo 0)%25-orange)

## ğŸ“š æ¦‚è¦

TypeScriptå‹ã‚·ã‚¹ãƒ†ãƒ ã®æ·±ã„ç†è§£ã‚’ç›®æŒ‡ã—ã¦ã€[Type Challenges](https://github.com/type-challenges/type-challenges)ã«æŒ‘æˆ¦ã—ã¦ã„ã¾ã™ã€‚

## ğŸ¯ ç¾åœ¨ã®é€²æ—

\`\`\`
ç·å®Œäº†æ•°: ${TOTAL_SOLVED} / ${TOTAL_ATTEMPTS}
å®Œäº†ç‡: $([ $TOTAL_ATTEMPTS -gt 0 ] && echo "scale=1; $TOTAL_SOLVED * 100 / $TOTAL_ATTEMPTS" | bc || echo 0)%

Easy:    $EASY_SOLVED / $EASY_TOTAL
Medium:  $MEDIUM_SOLVED / $MEDIUM_TOTAL  
Hard:    $HARD_SOLVED / $HARD_TOTAL
Extreme: $EXTREME_SOLVED / $EXTREME_TOTAL
\`\`\`

## ğŸ› ï¸ ç’°å¢ƒ

- **Node.js**: v24
- **TypeScript**: Latest
- **Linter/Formatter**: ESLint (ã‚ªãƒªã‚¸ãƒŠãƒ«type-challengesæº–æ‹ )
- **Test Runner**: Vitest
- **IDE**: VS Code with Dev Container

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

\`\`\`
my-type-challenges/
â”œâ”€â”€ original-type-challenges/  # ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæœ¬å®¶ï¼‰
â”œâ”€â”€ solutions/                 # è‡ªåˆ†ã®è§£ç­”
â”‚   â”œâ”€â”€ easy/
â”‚   â”œâ”€â”€ medium/
â”‚   â”œâ”€â”€ hard/
â”‚   â””â”€â”€ extreme/
â”œâ”€â”€ scripts/                   # è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ logs/                      # å­¦ç¿’ãƒ­ã‚°
â””â”€â”€ utils/                     # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å‹
\`\`\`

## ğŸ“– è©³ç´°

è©³ã—ã„é€²æ—ã¯ [progress.md](./progress.md) ã‚’ã”è¦§ãã ã•ã„ã€‚

---
*Last updated: $(date '+%Y-%m-%d %H:%M:%S')*
EOF

# ESLintã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npx eslint progress.md README.md --fix 2>/dev/null || true

git add progress.md README.md
git commit -m "ğŸ“Š Update progress: ${TOTAL_SOLVED}/${TOTAL_ATTEMPTS} solved

- Easy: ${EASY_SOLVED}/${EASY_TOTAL}
- Medium: ${MEDIUM_SOLVED}/${MEDIUM_TOTAL}
- Hard: ${HARD_SOLVED}/${HARD_TOTAL}
- Extreme: ${EXTREME_SOLVED}/${EXTREME_TOTAL}"

echo "âœ… é€²æ—ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼"
echo "ğŸ“ˆ å®Œäº†: ${TOTAL_SOLVED}/${TOTAL_ATTEMPTS}"
